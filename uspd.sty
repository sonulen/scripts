%% Copyright (c) Alexander V. Inyukhin, 2004.
%%длинные листы утверждения http://guap.ru/guap/standart/kach/espd_19.001-19.781.pdf
\usepackage{rotating}
\usepackage{ifthen}
\usepackage[singlelinecheck=false]{caption}%left aligment for tables captions

\usepackage{etoolbox}
\ifdef{\additionallapprove}{}{\newcommand{\additionallapprove}{}}

\usepackage{sectsty}
\sectionfont{\fontsize{12}{15}\selectfont\centering}
\subsectionfont{\normalfont\fontsize{12}{15}\selectfont}
\subsubsectionfont{\normalfont\selectfont}
\usepackage{longtable}

\graphicspath{ {images/} }
\DeclareGraphicsExtensions{.pdf,.png,.jpg}
\newcommand*{\No}{\textnumero}
\hoffset=-5.4mm
\voffset=-20.4mm
\marginparwidth=0mm
\marginparsep=0mm
\marginparpush=0mm
\evensidemargin=0mm
\oddsidemargin=0mm
\topmargin=0mm
\headheight=15mm
\headsep=5mm
\textwidth=180mm
\textheight=247mm
\footskip=10mm
\setlength{\unitlength}{1mm}

\def\ps@uspdliheadings{
  \let\@oddfoot\@empty\let\@evenfoot\@empty
  \def\@oddhead{\\{\rightmark}\\}
  \def\@evenhead{\\{\leftmark}\\}
  \let\@mkboth\@gobbletwo
  \let\sectionmark\@gobble
  \let\subsectionmark\@gobble
}

\def\ps@uspdluheadings{
  %\def\@oddfoot{\\{Литера <<О>>}}
  %\def\@evenfoot{\\{Литера <<О>>}}
  \let\@oddhead\@empty\let\@evenhead\@empty
  \let\@mkboth\@gobbletwo
  \let\sectionmark\@gobble
  \let\subsectionmark\@gobble
}

\def\ps@uspdnormheadings{
  \let\@oddfoot\@empty\let\@evenfoot\@empty
  \def\@oddhead{
  	\vbox{
		\vbox{\hfil\thepage\hfil}
		{\vskip 5mm}
		\vbox{\hfil\rightmark\hfil}
	}
  }
  \def\@evenhead{\\{\leftmark}\\}
  \let\@mkboth\@gobbletwo
  \let\sectionmark\@gobble
  \let\subsectionmark\@gobble
}

\pagestyle{uspdnormheadings}

\newcommand\stamp[1]{{
\newpage
\noindent\begin{picture}(0,0)(0,0)
\put(-12,-252){\framebox(12,145)}
\put(-7,-252){\line(0,1){145}}
\put(-12,-142){\line(1,0){12}}
\put(-12,-167){\line(1,0){12}}
\put(-12,-192){\line(1,0){12}}
\put(-12,-227){\line(1,0){12}}
\put(-11,-251){\begin{sideways}\parbox[t]{23mm}{\small Инв. {\No} подп.}\end{sideways}}
\put(-11,-226){\begin{sideways}\parbox[t]{33mm}{\small Подп. и дата}\end{sideways}}
\put(-11,-191){\begin{sideways}\parbox[t]{23mm}{\small Взам инв. {\No}}\end{sideways}}
\put(-11,-166){\begin{sideways}\parbox[t]{23mm}{\small Инв. {\No} дубл.}\end{sideways}}
\put(-11,-141){\begin{sideways}\parbox[t]{33mm}{\small Подп. и дата}\end{sideways}}
\end{picture}
#1
\newpage
}}

\newcommand\signfield[1]{\underline{\phantom{ЖЖЖЖЖ}}~{#1}}
\newcommand\datefield{<<\underline{\phantom{Ж}}>>~\underline{\phantom{ЖЖЖЖЖ}}~{\number\year}~г.}
\newcommand\pagesfield[1]{\ifthenelse{\pageref{#1} > 1}{Листов \pageref{#1}}{}}

\newcommand\LU[1]{\markboth{{#1}--ЛУ}{{#1}--ЛУ}\setcounter{page}{1}
\thispagestyle{uspdluheadings}
%\stamp{
%% field 0, label
%%{\noindent\hfill Совершенно секретно}
%
%\begin{center}
%% field 1, organization
%ООО НПП «Стрела»
%
%% field 2, names and signatures
%\begin{tabular}{p{70mm}cp{70mm}}
%\\\\
%\ifthenelse{\boolean{needmilitary}}{Согласовано}{} & & Утверждаю \\[-0.5cm]
%& & \\
%\ifthenelse{\boolean{needmilitary}}{Начальник \militarydep}{} & & \approvedby \\
%\ifthenelse{\boolean{needmilitary}}{\signfield{\militarydephead}}{} & &\\ 
%& &\signfield{\approvedbyname} \\
%\ifthenelse{\boolean{needmilitary}}{\datefield}{}  & & \datefield \\
%\end{tabular}
%
%\vskip 20mm
%
%% field 3, program name, allcaps
%
%\makeatletter
%\@title
%\makeatother
%
%\vskip 7mm
%
%{Лист утверждения}
%
%\vskip 10mm
%
%% field 4, document id, storage type
%
%{{#1}--ЛУ}
%
%%{\scriptsize (вид носителя данных)}
%
%%field 5, number of sheets (only if > 1)
%\pagesfield{endlu}
%
%\vskip 10mm
%
%% field 6, 
%\begin{longtable}{p{70mm}cp{70mm}}
%%СОГЛАСОВАНО 
%%& & Пред\-ста\-ви\-те\-ли пред\-при\-я\-тия--раз\-ра\-бот\-чи\-ка ИПС РАН \\
%%& & \\
%%Исполнительный директор Программы <<СКИФ>> от РФ & & Разработал \\
%%директор ИПС РАН 
%& & Разработал \\
%%\signfield{Абрамов~С.~М.} 
%& & \signfield\preparedby \\
%%\datefield 
%& & \datefield \\
%& & \\
%& & Проверил \\
%& & \signfield\checkedby \\
%& & \datefield \\
%& & \\
%
%& & Начальник отдела \developdep \\
%& & \signfield\developdephead \\
%& & \datefield \\
%& & \\
%\additionallapprove
%\ifthenelse{\boolean{needmilitary}}{от \militarydep}{}     & & Нормоконтроль \\
%\ifthenelse{\boolean{needmilitary}}{\signfield{        }}{}& & \signfield{        } \\
%\ifthenelse{\boolean{needmilitary}}{\datefield}{}       & & \datefield \\
%\end{longtable}
%
%% field 7, year
%\vfill
%%{{\number\year}}
%\end{center}
%\label{endlu}
%}



\newcommand\TP[1]{{\markboth{{#1}}{{#1}}\setcounter{page}{1}\thispagestyle{uspdluheadings}\stamp{



\begin{center}
{\noindent ООО НПП «Стрела»}
\end{center}



{Утвержден}

{{#1}--ЛУ}

\vskip 10mm

% field 1, organization
%\begin{center}
%{Московский Государственный Университет имени М. В. Ломоносова}
%\end{center}

% field 2, names and signatures
{}

\vskip 20mm

% field 3, program name, allcaps
\begin{center}
\makeatletter
\@title
\makeatother

\end{center}

\vskip 20mm

% field 4, document id, storage type
\begin{center}
{{#1}}
%{\scriptsize (вид носителя данных)}
\end{center}

% field 5, number of sheets (only if > 1)
\begin{center}
\pagesfield{enddoc}
\end{center}

% field 6, 

% field 7, year
\vfill
\begin{center}
%{{\number\year}}
\end{center}
}}
}}

\newcommand\uspd@LI{{
\newpage
%\thispagestyle{uspdliheadings}
\noindent\begin{picture}(185,247)(0,0)
%\put(0,0){\framebox(12,145)}
\put(0,0){\line(0,1){247}}
\put(8,0){\line(0,1){232}}
\put(28,0){\line(0,1){232}}
\put(48,0){\line(0,1){232}}
\put(68,0){\line(0,1){232}}
\put(88,0){\line(0,1){237}}
\put(108,0){\line(0,1){237}}
\put(133,0){\line(0,1){237}}
\put(158,0){\line(0,1){237}}
\put(173,0){\line(0,1){237}}
\put(185,0){\line(0,1){247}}
\put(0,247){\line(1,0){185}}
\put(0,237){\line(1,0){185}}
\put(0,232){\line(1,0){88}}
\put(0,212){\line(1,0){185}}
\put(0,0){\line(1,0){185}}
\multiput(0,207)(0,-5){41}{\line(1,0){185}}
\put(0,237){\makebox[185mm][c]{\raisebox{2\depth}{\Large Лист регистрации изменений}}}
\put(0,232){\makebox[88mm][c]{\raisebox{1.5\depth}{\small Номера листов (страниц)}}}
\put(0.5,227){\parbox[t]{7mm}{\small Изм}}
\put(9,227){\parbox[t]{18mm}{\small из\-ме\-нён\-ных}}
\put(29,227){\parbox[t]{18mm}{\small за\-ме\-нён\-ных}}
\put(49,227){\parbox[t]{18mm}{\small но\-вых}}
\put(69,227){\parbox[t]{18mm}{\small ан\-ну\-ли\-ро\-ван\-ных}}
\put(89,232){\parbox[t]{18mm}{\small Всего листов (страниц) в докум}}
\put(109,232){\parbox[t]{23mm}{\small {\No} документа}}
\put(134,232){\parbox[t]{23mm}{\small Входящий {\No} сопроводительного докум и дата}}
\put(159,232){\parbox[t]{13mm}{\small Подп}}
\put(174,232){\parbox[t]{10mm}{\small Дата}}
\label{enddoc}
\end{picture}
\newpage
}}


\makeatletter
	\renewcommand*\l@subsection{\@dottedtocline{2}{0em}{3.2 em}}
	\renewcommand*\l@subsubsection{\@dottedtocline{2}{0em}{3.2 em}}
	\let\@uspdabstract\relax
	\newcommand\uspdabstract[1]{\def\@uspdabstract{#1}}
	\newenvironment{uspd}[1]{\sloppy\LU{#1}\TP{#1}\ifthenelse{\boolean{needtableofcontents}}{\section*{Аннотация}\@uspdabstract\newpage\tableofcontents}{}\newpage}{\uspd@LI}
\makeatother

